<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1150px" preserveAspectRatio="none" style="width:1336px;height:1150px;background:#00000000;" version="1.1" viewBox="0 0 1336 1150" width="1336.4583px" zoomAndPan="magnify"><defs><linearGradient id="g5yosbli2uix20" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#59B6EC"/><stop offset="100%" stop-color="#2FA4E7"/></linearGradient></defs><g><rect fill="none" height="186.1084" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="367.7083" x="20.8333" y="115.9017"/><rect fill="none" height="479.3701" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="580.7292" x="259.375" y="342.6351"/><rect fill="none" height="411.5234" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="559.8958" x="269.7917" y="403.1901"/><rect fill="none" height="172.4284" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="539.0625" x="280.2083" y="543.1885"/><rect fill="none" height="146.3867" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="450" x="683.8542" y="836.5885"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="138.5417" x2="138.5417" y1="98.1934" y2="1040.4053"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="334.375" x2="334.375" y1="98.1934" y2="1040.4053"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="606.7708" x2="606.7708" y1="98.1934" y2="1040.4053"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="751.5625" x2="751.5625" y1="98.1934" y2="1040.4053"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="904.6875" x2="904.6875" y1="98.1934" y2="1040.4053"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1068.2292" x2="1068.2292" y1="98.1934" y2="1040.4053"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1250.5208" x2="1250.5208" y1="98.1934" y2="1040.4053"/><rect fill="url(#g5yosbli2uix20)" height="39.7217" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="131.25" x="72.9167" y="57.43"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="106.25" x="85.4167" y="82.015">Relayer side Rails</text><rect fill="url(#g5yosbli2uix20)" height="39.7217" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="131.25" x="72.9167" y="1039.3636"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="106.25" x="85.4167" y="1063.9486">Relayer side Rails</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="57.2917" x="302.6042" y="75.6266">Database</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="70.8333" x="295.8333" y="90.3483">relayer side</text><path d="M315.625,20.8333 C315.625,10.4167 334.375,10.4167 334.375,10.4167 C334.375,10.4167 353.125,10.4167 353.125,20.8333 L353.125,47.9167 C353.125,58.3333 334.375,58.3333 334.375,58.3333 C334.375,58.3333 315.625,58.3333 315.625,47.9167 L315.625,20.8333 " fill="url(#g5yosbli2uix20)" style="stroke:#2FA4E7;stroke-width:1.5625;"/><path d="M315.625,20.8333 C315.625,31.25 334.375,31.25 334.375,31.25 C334.375,31.25 353.125,31.25 353.125,20.8333 " fill="none" style="stroke:#2FA4E7;stroke-width:1.5625;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="57.2917" x="302.6042" y="1056.6569">Database</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="70.8333" x="295.8333" y="1071.3786">relayer side</text><path d="M315.625,1089.6403 C315.625,1079.2236 334.375,1079.2236 334.375,1079.2236 C334.375,1079.2236 353.125,1079.2236 353.125,1089.6403 L353.125,1116.7236 C353.125,1127.1403 334.375,1127.1403 334.375,1127.1403 C334.375,1127.1403 315.625,1127.1403 315.625,1116.7236 L315.625,1089.6403 " fill="url(#g5yosbli2uix20)" style="stroke:#2FA4E7;stroke-width:1.5625;"/><path d="M315.625,1089.6403 C315.625,1100.057 334.375,1100.057 334.375,1100.057 C334.375,1100.057 353.125,1100.057 353.125,1089.6403 " fill="none" style="stroke:#2FA4E7;stroke-width:1.5625;"/><rect fill="url(#g5yosbli2uix20)" height="39.7217" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="69.7917" x="572.3958" y="57.43"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="44.7917" x="584.8958" y="82.015">Relayer</text><rect fill="url(#g5yosbli2uix20)" height="39.7217" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="69.7917" x="572.3958" y="1039.3636"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="44.7917" x="584.8958" y="1063.9486">Relayer</text><path d="M699.4792,62.6383 L803.6458,62.6383 C808.8542,62.6383 808.8542,80.4159 808.8542,80.4159 C808.8542,80.4159 808.8542,98.1934 803.6458,98.1934 L699.4792,98.1934 C694.2708,98.1934 694.2708,80.4159 694.2708,80.4159 C694.2708,80.4159 694.2708,62.6383 699.4792,62.6383 " fill="url(#g5yosbli2uix20)" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><path d="M803.6458,62.6383 C798.4375,62.6383 798.4375,80.4159 798.4375,80.4159 C798.4375,98.1934 803.6458,98.1934 803.6458,98.1934 " fill="none" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="83.3333" x="704.6875" y="85.14">Cloud PubSub</text><path d="M699.4792,1039.3636 L803.6458,1039.3636 C808.8542,1039.3636 808.8542,1057.1411 808.8542,1057.1411 C808.8542,1057.1411 808.8542,1074.9186 803.6458,1074.9186 L699.4792,1074.9186 C694.2708,1074.9186 694.2708,1057.1411 694.2708,1057.1411 C694.2708,1057.1411 694.2708,1039.3636 699.4792,1039.3636 " fill="url(#g5yosbli2uix20)" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><path d="M803.6458,1039.3636 C798.4375,1039.3636 798.4375,1057.1411 798.4375,1057.1411 C798.4375,1074.9186 803.6458,1074.9186 803.6458,1074.9186 " fill="none" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="83.3333" x="704.6875" y="1061.8652">Cloud PubSub</text><rect fill="url(#g5yosbli2uix20)" height="39.7217" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="88.5417" x="860.9375" y="57.43"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="63.5417" x="873.4375" y="82.015">Subscriber</text><rect fill="url(#g5yosbli2uix20)" height="39.7217" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="88.5417" x="860.9375" y="1039.3636"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="63.5417" x="873.4375" y="1063.9486">Subscriber</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="57.2917" x="1036.9792" y="75.6266">Database</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="1019.2708" y="90.3483">subscriber side</text><path d="M1050,20.8333 C1050,10.4167 1068.75,10.4167 1068.75,10.4167 C1068.75,10.4167 1087.5,10.4167 1087.5,20.8333 L1087.5,47.9167 C1087.5,58.3333 1068.75,58.3333 1068.75,58.3333 C1068.75,58.3333 1050,58.3333 1050,47.9167 L1050,20.8333 " fill="url(#g5yosbli2uix20)" style="stroke:#2FA4E7;stroke-width:1.5625;"/><path d="M1050,20.8333 C1050,31.25 1068.75,31.25 1068.75,31.25 C1068.75,31.25 1087.5,31.25 1087.5,20.8333 " fill="none" style="stroke:#2FA4E7;stroke-width:1.5625;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="57.2917" x="1036.9792" y="1056.6569">Database</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="1019.2708" y="1071.3786">subscriber side</text><path d="M1050,1089.6403 C1050,1079.2236 1068.75,1079.2236 1068.75,1079.2236 C1068.75,1079.2236 1087.5,1079.2236 1087.5,1089.6403 L1087.5,1116.7236 C1087.5,1127.1403 1068.75,1127.1403 1068.75,1127.1403 C1068.75,1127.1403 1050,1127.1403 1050,1116.7236 L1050,1089.6403 " fill="url(#g5yosbli2uix20)" style="stroke:#2FA4E7;stroke-width:1.5625;"/><path d="M1050,1089.6403 C1050,1100.057 1068.75,1100.057 1068.75,1100.057 C1068.75,1100.057 1087.5,1100.057 1087.5,1089.6403 " fill="none" style="stroke:#2FA4E7;stroke-width:1.5625;"/><rect fill="url(#g5yosbli2uix20)" height="39.7217" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="150" x="1175.5208" y="57.43"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="125" x="1188.0208" y="82.015">Subscriber side Rails</text><rect fill="url(#g5yosbli2uix20)" height="39.7217" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="150" x="1175.5208" y="1039.3636"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="125" x="1188.0208" y="1063.9486">Subscriber side Rails</text><path d="M25,115.9017 L154.1667,115.9017 L154.1667,132.7067 L143.75,143.1234 L20.8333,143.1234 L20.8333,120.0684 A4.1667,4.1667 0 0 1 25,115.9017 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0416666666666667;"/><rect fill="none" height="186.1084" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="367.7083" x="20.8333" y="115.9017"/><text fill="#033C73" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="76.0417" x="41.6667" y="134.2367">Transaction</text><polygon fill="#2FA4E7" points="321.875,170.3451,332.2917,174.5117,321.875,178.6784,326.0417,174.5117" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="138.5417" x2="328.125" y1="174.5117" y2="174.5117"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="106.25" x="151.0417" y="164.5833">Begin Transaction</text><polygon fill="#2FA4E7" points="321.875,210.0667,332.2917,214.2334,321.875,218.4001,326.0417,214.2334" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="138.5417" x2="328.125" y1="214.2334" y2="214.2334"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="160.4167" x="151.0417" y="204.305">Insert/Update/Delete Data</text><polygon fill="#2FA4E7" points="321.875,249.7884,332.2917,253.9551,321.875,258.1217,326.0417,253.9551" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="138.5417" x2="328.125" y1="253.9551" y2="253.9551"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="69.7917" x="151.0417" y="244.0267">Insert Event</text><polygon fill="#2FA4E7" points="321.875,289.5101,332.2917,293.6768,321.875,297.8434,326.0417,293.6768" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="138.5417" x2="328.125" y1="293.6768" y2="293.6768"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="45.8333" x="151.0417" y="283.7484">Commit</text><path d="M263.5417,342.6351 L361.4583,342.6351 L361.4583,359.4401 L351.0417,369.8568 L259.375,369.8568 L259.375,346.8018 A4.1667,4.1667 0 0 1 263.5417,342.6351 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0416666666666667;"/><rect fill="none" height="479.3701" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="580.7292" x="259.375" y="342.6351"/><text fill="#033C73" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="44.7917" x="280.2083" y="360.9701">Polling</text><path d="M273.9583,403.1901 L403.125,403.1901 L403.125,419.9951 L392.7083,430.4118 L269.7917,430.4118 L269.7917,407.3568 A4.1667,4.1667 0 0 1 273.9583,403.1901 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0416666666666667;"/><rect fill="none" height="411.5234" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="559.8958" x="269.7917" y="403.1901"/><text fill="#033C73" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="76.0417" x="290.625" y="421.5251">Transaction</text><polygon fill="#2FA4E7" points="345.8333,457.6335,335.4167,461.8001,345.8333,465.9668,341.6667,461.8001" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="339.5833" x2="606.25" y1="461.8001" y2="461.8001"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="106.25" x="357.2917" y="451.8717">Begin Transaction</text><polygon fill="#2FA4E7" points="345.8333,497.3551,335.4167,501.5218,345.8333,505.6885,341.6667,501.5218" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="339.5833" x2="606.25" y1="501.5218" y2="501.5218"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="237.5" x="357.2917" y="491.5934">Select events where published_at is null</text><path d="M284.375,543.1885 L425,543.1885 L425,559.9935 L414.5833,570.4102 L280.2083,570.4102 L280.2083,547.3551 A4.1667,4.1667 0 0 1 284.375,543.1885 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0416666666666667;"/><rect fill="none" height="172.4284" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="539.0625" x="280.2083" y="543.1885"/><text fill="#033C73" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="87.5" x="301.0417" y="561.5234">events.each {}</text><polygon fill="#2FA4E7" points="739.0625,597.6318,749.4792,601.7985,739.0625,605.9652,743.2292,601.7985" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="607.2917" x2="745.3125" y1="601.7985" y2="601.7985"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="42.7083" x="619.7917" y="591.8701">Publish</text><polygon fill="#2FA4E7" points="618.75,637.3535,608.3333,641.5202,618.75,645.6868,614.5833,641.5202" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="612.5" x2="750.5208" y1="641.5202" y2="641.5202"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="52.0833" x="630.2083" y="631.5918">Message</text><polygon fill="#2FA4E7" points="345.8333,677.0752,335.4167,681.2419,345.8333,685.4085,341.6667,681.2419" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="339.5833" x2="606.25" y1="681.2419" y2="681.2419"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="227.0833" x="357.2917" y="671.3135">Update message_id and published_at</text><polygon fill="#2FA4E7" points="345.8333,776.1719,335.4167,780.3385,345.8333,784.5052,341.6667,780.3385" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="339.5833" x2="606.25" y1="780.3385" y2="780.3385"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="45.8333" x="357.2917" y="770.4102">Commit</text><path d="M688.0208,836.5885 L780.7292,836.5885 L780.7292,853.3936 L770.3125,863.8102 L683.8542,863.8102 L683.8542,840.7552 A4.1667,4.1667 0 0 1 688.0208,836.5885 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0416666666666667;"/><rect fill="none" height="146.3867" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="450" x="683.8542" y="836.5885"/><text fill="#033C73" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="39.5833" x="704.6875" y="854.9235">Listen</text><polygon fill="#2FA4E7" points="763.0208,891.0319,752.6042,895.1986,763.0208,899.3652,758.8542,895.1986" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="756.7708" x2="904.1667" y1="895.1986" y2="895.1986"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="58.3333" x="774.4792" y="885.2702">Subscribe</text><polygon fill="#2FA4E7" points="892.7083,930.7536,903.125,934.9202,892.7083,939.0869,896.875,934.9202" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="751.5625" x2="898.9583" y1="934.9202" y2="934.9202"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="52.0833" x="764.0625" y="924.9919">Message</text><polygon fill="#2FA4E7" points="1056.25,970.4753,1066.6667,974.6419,1056.25,978.8086,1060.4167,974.6419" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="905.2083" x2="1062.5" y1="974.6419" y2="974.6419"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="128.125" x="917.7083" y="964.7135">Insert/Update/Delete</text><polygon fill="#2FA4E7" points="1080.2083,1017.4886,1069.7917,1021.6553,1080.2083,1025.8219,1076.0417,1021.6553" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1073.9583" x2="1249.4792" y1="1021.6553" y2="1021.6553"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="67.7083" x="1091.6667" y="1011.7269">Read/Write</text><!--MD5=[8c4eb77c3d74a66ca441836dde959cb4]
@startuml
!theme cerulean


participant "Relayer side Rails" as RApp order 10
database "Database\nrelayer side" as RDB order 10
participant Relayer as Relayer order 20
queue "Cloud PubSub" as Queue order 30
participant Subscriber as Subscriber order 40
database "Database\nsubscriber side" as SDB order 50
participant "Subscriber side Rails" as SApp order 60

group Transaction
    RApp -> RDB: Begin Transaction
    RApp -> RDB: Insert/Update/Delete Data
    RApp -> RDB: Insert Event
    RApp -> RDB: Commit
end
|||
group Polling
|||
    group Transaction
        Relayer -> RDB: Begin Transaction
        Relayer -> RDB: Select events where published_at is null
|||
        group events.each {}
            Relayer -> Queue: Publish
            return Message

            Relayer -> RDB: Update message_id and published_at
|||
        end

|||
        Relayer -> RDB: Commit
|||
    end

end

group Listen
    Subscriber -> Queue: Subscribe
    return Message

    Subscriber -> SDB: Insert/Update/Delete
end

SApp -> SDB: Read/Write

@enduml

@startuml



skinparam backgroundColor transparent
skinparam useBetaStyle false






<style>
  root {
    BackgroundColor transparent
    FontColor #FFF
    HyperLinkColor #FD7E14
    LineColor #2683B9
    LineThickness 1
    Margin 10
    Padding 6
    Shadowing 0.0
  }
  node {
   Padding 15
   roundcorner 20
   BackgroundColor #2FA4E7-#2683B9
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  groupHeader {
    BackgroundColor #E9ECEF
    FontColor #033C73
    FontStyle bold
  }
  header {
    LineThickness 0
  }
  referenceHeader {
    BackgroundColor transparent
    FontColor #343A40
    FontStyle bold
  }
  separator {
    BackgroundColor #343A40
    FontColor transparent
    FontStyle bold
  }
  title {
	FontSize 20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor  #EDF0F2-#E9ECEF
	FontColor #2FA4E7
	BorderColor #E9ECEF
  }
  nwdiagDiagram {
	network {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7    
		LineColor #2FA4E7
		LineThickness 1.0
		FontColor #2683B9
	}
	server {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	}
	arrow {
		FontColor #2683B9
		LineColor #2683B9
	}
	group {
		BackGroundColor #F8F9FA
		LineColor $LIGHT_DARK
		LineThickness 2.0
		Margin 5
		Padding 5
	}
  }
  ganttDiagram {
	task {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
		LineColor #2FA4E7
		Margin 10
		Padding 6
	}
	note {
		FontColor #FFF
		LineColor #02305C
		BackGroundColor #033C73
	}
	separator {
		LineColor #E9ECEF
		BackGroundColor #E9ECEF-#BABDBF
		FontColor #343A40
	}
	milestone {
		FontColor #033C73
		FontSize 16
		FontStyle italic
		BackGroundColor #E9ECEF
		LineColor #BABDBF
	}
	timeline {
		BackgroundColor #E9ECEF
		FontColor #343A40
	}
	closed {
		BackgroundColor #B14500
		FontColor #FFF
	}
  }
</style>
skinparam defaultFontName        "Verdana"
skinparam defaultFontSize        12
skinparam dpi                    100
skinparam shadowing              false
skinparam roundcorner            8
skinparam ParticipantPadding     40
skinparam BoxPadding             40
skinparam Padding                5
skinparam ArrowColor             #868E96
skinparam stereotype {
    CBackgroundColor #EDF0F2
    CBorderColor #BABDBF
    ABackgroundColor #8FB961
    ABorderColor #5C862E
    IBackgroundColor #D2494E
    IBorderColor #9F161B
    EBackgroundColor #E47833
    EBorderColor #B14500
    NBackgroundColor #35638F
    NBorderColor #02305C
}
skinparam title {
	FontColor	                 #2FA4E7
	BorderColor	                 #BABDBF
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              #EDF0F2-#E9ECEF
}


skinparam legend {
	BackgroundColor #E9ECEF
	BorderColor #BABDBF
	FontColor #343A40
}

skinparam swimlane {
	BorderColor #033C73
	BorderThickness 2
	TitleBackgroundColor  #EDF0F2-#E9ECEF
	TitleFontColor #2FA4E7
}


skinparam activity {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BarColor #73A839
	StartColor #033C73
	EndColor #033C73
	DiamondBackgroundColor #FFF-#EDF0F2
  	DiamondBorderColor #BABDBF
	DiamondFontColor #343A40
}


skinparam participant {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	ParticipantBorderThickness 2
}


skinparam actor {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam arrow {
	Thickness 3
	Color #2FA4E7
	FontColor #343A40
}


skinparam sequence {
	BorderColor #2FA4E7
	TitleFontColor #2FA4E7
	BackgroundColor transparent
	StartColor #2FA4E7
	EndColor #2FA4E7
	BoxBackgroundColor #F8F9FA
	BoxBorderColor #868E96
	BoxFontColor #343A40
	DelayFontColor #343A40
	LifeLineBorderColor #BABDBF
	LifeLineBorderThickness 2
	LifeLineBackgroundColor #EDF0F2
	GroupBorderColor #868E96
	GroupFontColor #343A40
	GroupHeaderFontColor #033C73
	DividerBackgroundColor #FFF-#F8F9FA
    DividerBorderColor #868E96
    DividerBorderThickness 2
    DividerFontColor #343A40
	ReferenceBackgroundColor transparent
	ReferenceBorderColor #868E96
	ReferenceFontColor #343A40
	ReferenceHeaderFontColor #033C73
	StereotypeFontColor #FFF
}


skinparam partition {
	BorderColor #2FA4E7
	FontColor #2FA4E7
	BackgroundColor transparent
}


skinparam collections {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam control {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam entity {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam boundary {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam agent {
	BackgroundColor #orange
	BorderColor #999999
	FontColor #333333
}


skinparam note {
	BorderThickness 1
	BackgroundColor #35638F-#033C73
	BorderColor #033C73
	FontColor #FFF
}


skinparam artifact {
	BackgroundColor #FFF-#F8F9FA
	BorderColor #BABDBF
	FontColor #343A40
}


skinparam component {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam interface {
	BackgroundColor  #D2494E
	BorderColor  #C71C22
	FontColor #343A40
}


skinparam storage {
	BackgroundColor #E47833-#DD5600
  	BorderColor #DD5600
	FontColor #FFF
}


skinparam node {
	BackgroundColor #EDF0F2-#E9ECEF
	BorderColor #E9ECEF
	FontColor #343A40
}


skinparam cloud {
	BackgroundColor #F2FCFE-#eeeeee
	BorderColor #F2FCFE
	FontColor #2FA4E7
}


skinparam database {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam class {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	HeaderBackgroundColor #2FA4E7-#2683B9
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #F8F9FA
	AttributeFontSize 11
}


skinparam object {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam usecase {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam rectangle {
	FontColor #2FA4E7
	BorderColor #59B6EC
	BackgroundColor transparent
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam package {
	FontColor #2FA4E7
	BorderColor #59B6EC
	BackgroundColor transparent
	BorderThickness 2
}


skinparam folder {
	BackgroundColor #FFF-#EDF0F2
  	BorderColor #DD5600
	FontColor #DD5600
	BorderThickness 2
}


skinparam frame {
	BackgroundColor #FFF-#EDF0F2
  	BorderColor #033C73
	FontColor #033C73
	BorderThickness 2
}


skinparam state {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BorderColor #2683B9
	StartColor #033C73
	EndColor #033C73
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam queue {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam card {
	BackgroundColor #35638F-#033C73
	BorderColor #033C73
	FontColor #FFF
}


skinparam file {
	BackgroundColor #EDF0F2-#E9ECEF
	BorderColor #033C73
	FontColor #868E96

}


skinparam stack {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


participant "Relayer side Rails" as RApp order 10
database "Database\nrelayer side" as RDB order 10
participant Relayer as Relayer order 20
queue "Cloud PubSub" as Queue order 30
participant Subscriber as Subscriber order 40
database "Database\nsubscriber side" as SDB order 50
participant "Subscriber side Rails" as SApp order 60

group Transaction
    RApp -> RDB: Begin Transaction
    RApp -> RDB: Insert/Update/Delete Data
    RApp -> RDB: Insert Event
    RApp -> RDB: Commit
end
|||
group Polling
|||
    group Transaction
        Relayer -> RDB: Begin Transaction
        Relayer -> RDB: Select events where published_at is null
|||
        group events.each {}
            Relayer -> Queue: Publish
            return Message

            Relayer -> RDB: Update message_id and published_at
|||
        end

|||
        Relayer -> RDB: Commit
|||
    end

end

group Listen
    Subscriber -> Queue: Subscribe
    return Message

    Subscriber -> SDB: Insert/Update/Delete
end

SApp -> SDB: Read/Write

@enduml

PlantUML version 1.2022.7(Tue Aug 23 02:01:30 JST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>