#!/usr/bin/env ruby
require 'google/cloud/pubsub'
require 'logger'

logger = Logger.new($stdout)

topic_id = ENV["PUBSUB_TOPIC_ID"] || 'trabox'
subscription_id = ENV["PUBSUB_SUBSCRIPTION_ID"] || 'trabox-sub'

pubsub = Google::Cloud::Pubsub.new

##################
#  create topic  #
##################

logger.info "Create Topic"

topic = pubsub.topic topic_id

topic&.delete

topic = pubsub.create_topic topic_id

puts "Topic #{topic.name} created."

#########################
#  create subscription  #
#########################

logger.info "Create Subscription"

subscription = topic.subscription subscription_id

subscription&.delete

topic.subscribe subscription_id, message_ordering: true

puts "Pull subscription #{subscription_id} created with message ordering."

# vim:ft=ruby:
