#!/usr/bin/env ruby

require 'trabox/command'

$stdout.sync = true
$stderr.sync = true

command_parser = Trabox::Command::Parser.new
begin
  command = command_parser.parse!

  require 'trabox/runner'

  log_level = Rails.logger.level

  trap('USR1') do
    Rails.logger.level = :debug
  end

  trap('USR2') do
    Rails.logger.level = log_level
  end

  Trabox::Command.invoke command
rescue StandardError => e
  warn e.message
  warn ""
  warn optparse.usage
  exit 1
end

# vim:ft=ruby:
