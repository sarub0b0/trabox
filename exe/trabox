#!/usr/bin/env ruby

require 'trabox/runner'

$stdout.sync = true
$stderr.sync = true

log_level = Rails.logger.level

trap('USR1') do
  Rails.logger.level = :debug
end

trap('USR2') do
  Rails.logger.level = log_level
end

optparse = Trabox::Command::OptParse.new
begin
  command = optparse.parse!

  Trabox::Command.invoke command
rescue StandardError => e
  warn e.message
  warn ""
  warn optparse.usage
  exit 1
end

# vim:ft=ruby:
